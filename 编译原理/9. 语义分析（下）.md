词法分析和语法分析阶段，进行的处理都是上下文无关的。

语义分析的本质，就是针对上下文相关的情况做处理。作用域，是一种上下文相关的情况，因为如果作用域不同，能使用的变量也是不同的。类型系统也是一种上下文相关的情况，类型推导和类型检查都要基于上下文中相关的 AST 节点。

## 语义分析场景：引用的消解
在程序中，当我们使用一个变量、函数和类时，我们需要知道他们指的是谁，定义是什么，比如使用变量a时，需要知道a是全局变量，还是函数局部变量。所以我们要找到正确的引用，这个过程叫做引用消解。在IDE中，我们电仪一个变量、函数或类时可以跳转到它的定义，重构时可以引用它的地方都可以同步修改，这就是因为IDE分析了符号之间的交叉引用关系。



函数消解时，不仅要找到函数名，还要比较函数参数、函数返回值。

当一个参数需要一个对象的时候，程序中提供其子类的一个实例也是可以的，也就是子类可以用在所有需要父类的地方。

它还要考虑某个实参是否能够被自动转换成形参所要求的类型，比如在一个需要 double 类型的地方，你给它传一个 int 也是可以的。

做引用消解可能会产生几个结果：

* 解析出了准确的引用关系。
* 重复定义（在声明新的符号的时候，发现这个符号已经被定义过了）。
* 引用失败（找不到某个符号的定义）。
* 如果两个不同的命名空间中都有相同名称的符号，编程者需要明确指定。

## 语义分析场景：左值和右值
左值，一般指变量的地址。
* 赋值表达式的左边；
* 带有初始化的变量声明语句中的变量；
* 当给函数形参赋值的时候；
* 一元操作符： ++ 和–。
* 其他需要改变变量内容的操作。

但是不是所有的变量都能获取左值， 比如2+3就不能在赋值符号的左边，所以，判断表达式能否生成一个合格的左值也是语义检查的一项工作。

右值，一般指变量的值。

## 如何做属性计算
属性计算是做上下文分析，或者说语义分析的一种算法。按照属性计算的视角，我们之前所处理的各种语义分析问题，都可以看做是对 AST 节点的某个属性进行计算。比如，针对求左值场景中的 primary 节点，它需要计算的属性包括：

* 它的变量定义是哪个（这就引用到定义该变量的 Symbol）。
* 它的类型是什么?
* 它的作用域是什么？这个节点求值时，是否该返回左值？能否正确地返回一个左值？
* 它的值是什么？